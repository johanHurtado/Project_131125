<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Recuperar contraseÃ±a | Inventario & Mantenimientos HSRT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg-grad-light: linear-gradient(180deg, #eaf4ff 0%, #e0eefc 100%);
      --bg-grad-dark: linear-gradient(180deg,#08192b 0%, #01203a 100%);
      --card-light: rgba(255,255,255,0.95);
      --card-dark: rgba(6,21,36,0.92);
      --text-light: #072032;
      --text-dark: #e6f2ff;
      --input-light: #e9f0fa;
      --input-dark: #0e2433;
      --primary: linear-gradient(90deg,#0ea5ff,#0077ff);
    }

    /* PÃ¡gina base */
    html,body { height:100%; margin:0; }
    body {
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background: var(--bg-grad-light);
      transition: background .25s ease, color .25s ease;
      padding: 28px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* Dark mode */
    body.dark {
      background: var(--bg-grad-dark);
      color: var(--text-dark);
    }

    /* Card */
    .recover-card {
      width:100%;
      max-width:420px;
      border-radius:18px;
      padding:28px;
      background: var(--card-light);
      box-shadow: 0 18px 50px rgba(7,12,31,0.06);
      transition: background .25s ease, box-shadow .25s ease, transform .15s ease;
    }
    body.dark .recover-card {
      background: var(--card-dark);
      box-shadow: 0 24px 80px rgba(0,0,0,0.55);
    }

    .recover-card h1 { font-size:1.5rem; font-weight:700; color: #072032; }
    body.dark .recover-card h1 { color: var(--text-dark); }

    .recover-card p { color: #5b6b78; }
    body.dark .recover-card p { color: #9fb6d9; }

    /* Inputs */
    .form-control {
      border-radius:10px;
      padding:10px 12px;
      background: var(--input-light);
      border: 1px solid rgba(11, 66, 122, 0.06);
      color: var(--text-light);
    }
    body.dark .form-control {
      background: var(--input-dark);
      color: var(--text-dark);
      border: 1px solid rgba(255,255,255,0.04);
    }

    /* Button primary style (gradient) */
    .btn-primary {
      background-image: var(--primary);
      color: white;
      border: none;
      border-radius:10px;
      padding:10px 14px;
      font-weight:700;
      box-shadow: 0 8px 20px rgba(7,12,31,0.08);
      transition: transform .12s ease, box-shadow .12s ease, opacity .12s;
    }
    .btn-primary:active { transform: translateY(1px); }
    .btn-primary[disabled] { opacity: .7; }

    /* Small link */
    a.small { color: #0b63d6; font-weight:600; }
    body.dark a.small { color: #6fc7ff; }

    /* Theme toggle button (exact style like login: circular, top-right) */
    #themeToggle {
      position: fixed;
      right: 22px;
      top: 18px;
      width:48px;
      height:48px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(255,255,255,0.95);
      border: none;
      box-shadow: 0 6px 18px rgba(7,12,31,0.12);
      cursor: pointer;
      z-index: 1060;
      transition: background .18s ease, transform .12s ease;
    }
    #themeToggle:active { transform: scale(.98); }

    /* Dark-mode look for toggle */
    body.dark #themeToggle {
      background: rgba(0,0,0,0.48);
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
      color: #fff;
    }

    /* icon within button */
    #themeToggle .icon {
      font-size: 18px;
      line-height:1;
      pointer-events:none;
    }

    /* responsive tweaks */
    @media (max-width:480px){
      #themeToggle { right: 12px; top: 12px; width:42px; height:42px; }
      .recover-card { padding:20px; }
    }
  </style>
</head>
<body>
  <!-- Theme toggle (same position & look as your login) -->
  <button id="themeToggle" aria-label="Cambiar tema" title="Cambiar tema">
    <span class="icon" id="themeIcon">ðŸŒ™</span>
  </button>

  <div class="recover-card">
    <div class="text-center mb-3">
      <!-- UsÃ© tu imagen subida como preview: /mnt/data/b6a41294-172e-4da4-aa32-967fb008d751.png -->
      <img src="img/logosanrafa.png" alt="HSRT logo" style="max-width:140px; filter:drop-shadow(0 6px 10px rgba(0,0,0,0.06));">
    </div>

    <h1 class="text-center mb-2">Recuperar contraseÃ±a</h1>
    <p class="text-center mb-3">Ingrese su usuario para generar un enlace de recuperaciÃ³n.</p>

    <% if (error) { %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>

    <% if (message) { %>
      <div class="alert alert-info alert-dismissible fade show" role="alert">
        <%= message %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>

    <% if (resetLink) { %>
      <div class="alert alert-warning small">
        <strong>Enlace de prueba (modo demo):</strong><br>
        <a href="<%= resetLink %>"><%= resetLink %></a>
      </div>
    <% } %>

    <form method="post" action="/forgot-password">
      <div class="mb-3">
        <label class="form-label fw-semibold">Usuario</label>
        <input type="text" name="username" class="form-control" required>
      </div>

      <button class="btn btn-primary w-100 mt-2" id="btnGenerate">
        Generar enlace
      </button>
    </form>

    <p class="text-center mt-3 mb-0">
      <a href="/login" class="small">Volver al login</a>
    </p>
  </div>

  <script>
    // Theme logic (same as login behavior)
    (function () {
      const btn = document.getElementById('themeToggle');
      const icon = document.getElementById('themeIcon');
      const body = document.body;
      const LS_KEY = 'hsrt-theme-mode';

      function applyMode(mode) {
        if (mode === 'dark') {
          body.classList.add('dark');
          icon.textContent = 'ðŸŒž'; // sol en dark
        } else {
          body.classList.remove('dark');
          icon.textContent = 'ðŸŒ™'; // luna en light
        }
      }

      // Decide initial theme: saved -> system -> light
      const saved = localStorage.getItem(LS_KEY);
      if (saved) {
        applyMode(saved === 'dark' ? 'dark' : 'light');
      } else {
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        applyMode(prefersDark ? 'dark' : 'light');
      }

      btn.addEventListener('click', () => {
        const isDark = document.body.classList.contains('dark');
        const next = isDark ? 'light' : 'dark';
        applyMode(next);
        localStorage.setItem(LS_KEY, next);
      });

      // Also respond if system preference changes and user hasn't explicitly set theme
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (!localStorage.getItem(LS_KEY)) {
          applyMode(e.matches ? 'dark' : 'light');
        }
      });
    })();

    // Disable button text while submitting (preserves backend)
    (function(){
      const form = document.querySelector('form');
      const genBtn = document.getElementById('btnGenerate');
      form.addEventListener('submit', () => {
        genBtn.disabled = true;
        genBtn.textContent = 'Generando...';
      });
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
